<!DOCTYPE html><html lang=en> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width, initial-scale=1.0"><link rel="shortcut icon" href=../../img/favicon.ico><meta name=viewport content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"><title>关键字decltype - 记录</title><link href=../../css/bootstrap-3.3.7.min.css rel=stylesheet><link href=../../css/font-awesome-4.7.0.css rel=stylesheet><link href=../../css/base.css rel=stylesheet><link rel=stylesheet href=../../css/highlight.css><!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries --><!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]--><script src=../../js/jquery-3.2.1.min.js></script><script src=../../js/bootstrap-3.3.7.min.js></script><script src=../../js/highlight.pack.js></script><base target=_top><script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "C++11\u65b0\u6807\u51c6\u5b66\u4e60\uff1adecltype\u5173\u952e\u5b57", url: "#_top", children: [
              {title: "1. decltype\u7684\u610f\u4e49", url: "#1-decltype" },
              {title: "2. decltype\u7528\u6cd5", url: "#2-decltype" },
              {title: "3. decltype\u603b\u7ed3", url: "#3-decltype" },
          ]},
        ];

    </script><script src=../../js/base.js></script></head> <body> <script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script> <div class="container-fluid wm-page-content"> <a name=_top></a> <div class="row wm-article-nav-buttons" role=navigation aria-label=navigation> <div class="wm-article-nav pull-right"> <a href=../%E5%85%B3%E9%94%AE%E5%AD%97volatile/ class="btn btn-xs btn-default pull-right"> Next <i class="fa fa-chevron-right" aria-hidden=true></i> </a> <a href=../%E5%85%B3%E9%94%AE%E5%AD%97volatile/ class="btn btn-xs btn-link"> 关键字volatile </a> </div> <div class=wm-article-nav> <a href=../../DataStructure/AVL%E6%A0%91/ class="btn btn-xs btn-default pull-left"> <i class="fa fa-chevron-left" aria-hidden=true></i> Previous</a><a href=../../DataStructure/AVL%E6%A0%91/ class="btn btn-xs btn-link"> AVL树 </a> </div> </div> <h1 id=c11decltype>C++11新标准学习：decltype关键字<a class=headerlink href=#c11decltype title="Permanent link">&para;</a></h1> <h2 id=1-decltype>1. decltype的意义<a class=headerlink href=#1-decltype title="Permanent link">&para;</a></h2> <p>有时我们希望从表达式的类型推断出要定义的变量类型，但是不想用该表达式的值初始化变量（初始化可以用<code>auto</code>）。为了满足这一需求，C++11新标准引入了<code>decltype</code>类型说明符，它的作用是选择并返回操作数的数据类型，在此过程中，编译器分析表达式并得到它的类型，却不实际计算表达式的值。</p> <h2 id=2-decltype>2. decltype用法<a class=headerlink href=#2-decltype title="Permanent link">&para;</a></h2> <ul> <li>(1) 基本用法</li> </ul> <div class=highlight><pre><span></span><code>int getSize();

int main(void)
{
    int tempA = 2;

    /*1.dclTempA为int.*/
    decltype(tempA) dclTempA;
    /*2.dclTempB为int，对于getSize根本没有定义，但是程序依旧正常，因为decltype只做分析，并不调用getSize().*/
    decltype(getSize()) dclTempB;

    return 0;
}
</code></pre></div> <ul> <li>(2) 与const结合</li> </ul> <div class=highlight><pre><span></span><code>    double tempA = 3.0;
    const double ctempA = 5.0;
    const double ctempB = 6.0；
    const double *const cptrTempA = &amp;ctempA;

    /*1.dclTempA推断为const double（保留顶层const，此处与auto不同）*/
    decltype(ctempA) dclTempA = 4.1;
    /*2.dclTempA为const double，不能对其赋值，编译不过*/
    dclTempA = 5;
    /*3.dclTempB推断为const double * const*/
    decltype(cptrTempA) dclTempB = &amp;ctempA;
    /*4.输出为4（32位计算机）和5*/
    cout&lt;&lt;sizeof(dclTempB)&lt;&lt;&quot;    &quot;&lt;&lt;*dclTempB&lt;&lt;endl;
    /*5.保留顶层const，不能修改指针指向的对象，编译不过*/
    dclTempB = &amp;ctempB;
    /*6.保留底层const，不能修改指针指向的对象的值，编译不过*/
    *dclTempB = 7.0;
</code></pre></div> <ul> <li>(3) 与引用结合</li> </ul> <div class=highlight><pre><span></span><code>    int tempA = 0, &amp;refTempA = tempA;

    /*1.dclTempA为引用，绑定到tempA*/
    decltype(refTempA) dclTempA = tempA;
    /*2.dclTempB为引用，必须绑定到变量，编译不过*/
    decltype(refTempA) dclTempB = 0;
    /*3.dclTempC为引用，必须初始化，编译不过*/
    decltype(refTempA) dclTempC;
    /*4.双层括号表示引用，dclTempD为引用，绑定到tempA*/
    decltype((tempA)) dclTempD = tempA;

    const int ctempA = 1, &amp;crefTempA = ctempA;

    /*5.dclTempE为常量引用，可以绑定到普通变量tempA*/
    decltype(crefTempA) dclTempE = tempA;
    /*6.dclTempF为常量引用，可以绑定到常量ctempA*/
    decltype(crefTempA) dclTempF = ctempA;
    /*7.dclTempG为常量引用，绑定到一个临时变量*/
    decltype(crefTempA) dclTempG = 0;
    /*8.dclTempH为常量引用，必须初始化，编译不过*/
    decltype(crefTempA) dclTempH;
    /*9.双层括号表示引用,dclTempI为常量引用，可以绑定到普通变量tempA*/
    decltype((ctempA))  dclTempI = ctempA;
</code></pre></div> <ul> <li>(4) 与指针结合</li> </ul> <div class=highlight><pre><span></span><code>    int tempA = 2;
    int *ptrTempA = &amp;tempA;
    /*1.常规使用dclTempA为一个int *的指针*/
    decltype(ptrTempA) dclTempA;
    /*2.需要特别注意，表达式内容为解引用操作，dclTempB为一个引用，引用必须初始化，故编译不过*/
    decltype(*ptrTempA) dclTempB;
</code></pre></div> <h2 id=3-decltype>3. decltype总结<a class=headerlink href=#3-decltype title="Permanent link">&para;</a></h2> <p>decltype和auto都可以用来推断类型，但是二者有几处明显的差异：</p> <ol> <li>auto忽略顶层const，decltype保留顶层const；</li> <li>对引用操作，auto推断出原有类型，decltype推断出引用；</li> <li>对解引用操作，auto推断出原有类型，decltype推断出引用；</li> <li>auto推断时会实际执行，decltype不会执行，只做分析。总之在使用中过程中和const、引用和指针结合时需要特别小心。</li> </ol> <br> <div class="row wm-article-nav-buttons" role=navigation aria-label=navigation> <div class="wm-article-nav pull-right"> <a href=../%E5%85%B3%E9%94%AE%E5%AD%97volatile/ class="btn btn-xs btn-default pull-right"> Next <i class="fa fa-chevron-right" aria-hidden=true></i> </a> <a href=../%E5%85%B3%E9%94%AE%E5%AD%97volatile/ class="btn btn-xs btn-link"> 关键字volatile </a> </div> <div class=wm-article-nav> <a href=../../DataStructure/AVL%E6%A0%91/ class="btn btn-xs btn-default pull-left"> <i class="fa fa-chevron-left" aria-hidden=true></i> Previous</a><a href=../../DataStructure/AVL%E6%A0%91/ class="btn btn-xs btn-link"> AVL树 </a> </div> </div> <br> </div> <footer class="container-fluid wm-page-content"><p>Copyright &copy; 2020 - 2020 张磊</p> <p>Documentation built with <a href=http://www.mkdocs.org/ >MkDocs</a> using <a href=https://github.com/gristlabs/mkdocs-windmill>Windmill</a> theme by Grist Labs.</p> </footer> </body> </html>